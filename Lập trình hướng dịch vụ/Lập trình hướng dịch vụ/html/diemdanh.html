<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GV - Quản Lý Điểm Danh</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="../css/admin.css">

    <script src="../angular/angular.min.js"></script>

    <style>
        /* --- CSS RIÊNG CHO TRANG ĐIỂM DANH --- */

        /* Màu sắc trạng thái */
        .status-comat {
            color: #198754;
            font-weight: bold;
        }

        /* Xanh lá */
        .status-vang {
            color: #dc3545;
            font-weight: bold;
        }

        /* Đỏ */
        .status-dimuon {
            color: #fd7e14;
            font-weight: bold;
        }

        /* Cam */
        .status-vesom {
            color: #0d6efd;
            font-weight: bold;
        }

        /* Xanh dương */

        /* Tùy chỉnh ô nhập liệu trong bảng cho gọn */
        .bang-diemdanh select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
        }

        .bang-diemdanh input[type="time"] {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px;
            width: 100%;
            text-align: center;
        }

        .bang-diemdanh input[type="text"] {
            width: 100%;
            border: none;
            border-bottom: 1px dashed #ccc;
            padding: 5px;
            outline: none;
        }

        .bang-diemdanh input[type="text"]:focus {
            border-bottom: 1px solid #0d6efd;
            background-color: #f0f8ff;
        }

        /* Nút Lưu Tất Cả nổi bật */
        .btn-save-all {
            background-color: #198754;
            color: white;
            font-size: 15px;
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-save-all:hover {
            background-color: #157347;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body ng-app="UngDungGiaoVien" ng-controller="DiemDanhController">
    <div class="khungbao">

        <aside class="thanhben" style="background-color: #2c3e50;">
            <div class="dauthanhben" style="border-bottom: 1px solid #34495e;">
                <i class="fa-solid fa-chalkboard-user bieutuonglogo"></i>
                <span>Giáo Viên Lớp</span>
            </div>
            <ul class="menuthanhben">
                <li class="kichhoat"><a href="diemdanh.html"><i class="fa-solid fa-check-to-slot"></i> Điểm danh</a>
                </li>
                <li><a href="thongbao.html"><i class="fa-solid fa-bell"></i> Thông báo</a></li>
                <li><a href="hocsinh.html"><i class="fa-solid fa-users"></i> Danh sách lớp</a></li>
                <li class="mucdangxuat"><a href="#" onclick="dangXuat()"><i class="fa-solid fa-right-from-bracket"></i>
                        Đăng xuất</a></li>
            </ul>
        </aside>

        <main class="noidungchinh">
            <header class="dautrang">
                <div class="tieudetrang">
                    <h2>ĐIỂM DANH HỌC SINH</h2>
                    <p>Ngày làm việc: {{ ngayChon | date:'dd/MM/yyyy' }}</p>
                </div>
                <div class="thongtintaikhoan">
                    <i class="fa-solid fa-user-circle"></i>
                    <span>GV: Nguyễn Thị Thu Hà</span>
                </div>
            </header>

            <div class="khungnhaplieu"
                style="display: flex; align-items: center; gap: 20px; background: #fff; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ngày điểm danh:</label>
                    <input type="date" ng-model="ngayChon" ng-change="taiDuLieu()"
                        style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Lớp chủ nhiệm:</label>
                    <select ng-model="maLop" ng-change="taiDuLieu()"
                        style="padding: 8px; border: 1px solid #ccc; border-radius: 4px; min-width: 150px;">
                        <option value="MAM01">Mầm Non 01</option>
                        <option value="MAM02">Mầm Non 02</option>
                        <option value="CHOI01">Chồi 01</option>
                        <option value="LA01">Lá 01</option>
                    </select>
                </div>

                <div style="margin-top: 22px;">
                    <button class="nutbam nutthem" ng-click="taiDuLieu()" title="Tải lại dữ liệu">
                        <i class="fa-solid fa-rotate"></i>
                    </button>
                </div>

                <div style="margin-left: auto; margin-top: 22px;">
                    <button class="btn-save-all" ng-click="luuTatCa()">
                        <i class="fa-solid fa-floppy-disk"></i> LƯU TẤT CẢ
                    </button>
                </div>
            </div>

            <div class="banghienthi">
                <table class="bangdulieu bang-diemdanh">
                    <thead>
                        <tr>
                            <th width="5%" style="text-align: center;">STT</th>
                            <th width="10%">Mã HS</th>
                            <th width="18%">Họ và Tên</th>
                            <th width="10%">Ngày Sinh</th>
                            <th width="12%">Trạng Thái</th>
                            <th width="10%">Giờ Đến</th>
                            <th width="10%">Giờ Về</th>
                            <th>Ghi Chú</th>
                            <th width="5%" style="text-align: center;">Xóa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in dsDiemDanh">
                            <td style="text-align: center;">{{$index + 1}}</td>
                            <td>{{item.MaHocSinh}}</td>
                            <td style="font-weight:bold; color: #2c3e50;">{{item.HoTen}}</td>
                            <td>{{item.NgaySinh}}</td>

                            <td>
                                <select ng-model="item.TrangThai" ng-class="{
                                            'status-comat': item.TrangThai=='Có mặt',
                                            'status-vang': item.TrangThai=='Vắng',
                                            'status-dimuon': item.TrangThai=='Đi muộn',
                                            'status-vesom': item.TrangThai=='Về sớm'
                                        }">
                                    <option value="Có mặt">Có mặt</option>
                                    <option value="Vắng">Vắng</option>
                                    <option value="Đi muộn">Đi muộn</option>
                                    <option value="Về sớm">Về sớm</option>
                                </select>
                            </td>

                            <td><input type="time" ng-model="item.GioDenObject"></td>
                            <td><input type="time" ng-model="item.GioVeObject"></td>

                            <td>
                                <input type="text" ng-model="item.GhiChu" placeholder="Nhập lý do...">
                            </td>

                            <td style="text-align: center;">
                                <button class="nutbam nutxoa" ng-if="item.MaDiemDanh" ng-click="xoaDiemDanh(item)"
                                    title="Hủy điểm danh">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div ng-if="dsDiemDanh.length == 0"
                    style="text-align: center; padding: 30px; color: #7f8c8d; font-style: italic;">
                    <i class="fa-solid fa-box-open" style="font-size: 40px; margin-bottom: 10px;"></i><br>
                    Không tìm thấy dữ liệu học sinh nào.
                </div>
            </div>
        </main>
    </div>

    <script src="../js/giaovien.js"></script>

    <script>
        function dangXuat() {
            if (confirm('Bạn có chắc muốn đăng xuất?')) {
                window.location.href = '../index.html'; // Quay về trang chủ/login
            }
        }
    </script>
</body>

</html>